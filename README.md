# Fedresurs Bankrot Parser

Программа для автоматизированного каскадного сбора и глубокого анализа данных о банкротствах юридических и физических лиц с портала «Федресурс». Инструмент преобразует сырые данные из API в структурированный отчет Excel, полностью соответствующий требованиям ТЗ для дальнейшей аналитики.

## Технический стек
* **Язык разработки:** Java 17+
* **Обработка данных:** Jackson (JSON), Apache POI (генерация .xlsx)
* **Протоколы:** HTTP/REST API
* **Архитектурный паттерн:** Layered Architecture (Разделение на модели, парсеры, сервисы и утилиты)


## Архитектура и структура кода

Логика приложения распределена по пакетам для обеспечения масштабируемости и читаемости:

### 1. Пакет `ru.fpro.parser` (Data Acquisition)
Центральный узел программы. Реализует логику **каскадного сбора**:
* Сначала формируется первичный реестр через запросы к `/cnpbankrupts` (ЮЛ) или `/prsnbankrupts` (ФЛ).
* Для каждого объекта инициируется серия уточняющих запросов для получения детальной информации из карточки должника.

### 2. Пакет `ru.fpro.service` (Business Logic)
Слой консолидации. Здесь происходит агрегация данных:
* Объединение 4-5 различных JSON-ответов от API в единую плоскую структуру.
* Управление очередностью запросов и сборка финальных коллекций объектов перед экспортом.

### 3. Пакет `ru.fpro.model` (Data Models)
Содержит POJO-классы, жестко описывающие структуру данных:
* `LegalEntity` и `PhysicalPerson` — основные сущности.
* Поддержка вложенных структур (данные арбитражных управляющих, статистика торгов, публикации).

### 4. Пакет `ru.fpro.util` (Helper Tools)
Вспомогательные инструменты для чистоты данных:
* **RegionExtractor:** Автоматический парсинг строк адреса для определения кода субъекта РФ (необходимо для удобной фильтрации в Excel).
* **Data Cleansing Layer:** Утилиты для нормализации данных (удаление мусорных символов, замена `null` и `"н/д"` на пустые ячейки).


## Инженерные решения и оптимизация

### Сетевая устойчивость (Rate Limiting)
Портал «Федресурс» оснащен агрессивной защитой от парсинга. В коде реализован механизм **сетевой вежливости**:
* Константа `SLEEP_MS` (200мс) предотвращает блокировки по IP (ошибки 451/403).
* Пути к эндпоинтам вынесены в класс `FedresursEndpoints` для оперативной адаптации при смене версии API сайта.

### Работа с памятью (High Load Optimization)
Для предотвращения утечек памяти при выгрузках большого объема:
* Используется эффективное управление потоками записи библиотеки **Apache POI**.
* Данные записываются итерируемо, минимизируя нагрузку на RAM.

### Оптимизация запросов
Для сбора статистики (количество торгов/публикаций) не скачивается весь список целиком. Программа делает запрос с параметром `limit=1` и извлекает значение `total` из метаданных ответа, что сокращает объем трафика и время работы программы в десятки раз.


## Формат выходных данных

На выходе генерируется файл `.xlsx` с разделением на два листа:

1. **Юридические лица:** 21 колонка данных, включая ИНН, ОГРН, расширенные данные управляющего и полную статистику торгов.
2. **Физические лица:** 18 колонок, включая СНИЛС, регистрационные данные ИП и актуальные статусы дел.


## Инструкция по запуску

1. **Требования:** Наличие установленной JDK 17+.
2. **Сборка:** Выполнить команду сборки для загрузки зависимостей (Jackson, Apache POI).
3. **Запуск:** Запустить метод `main` в основном классе. 
4. **Результат:** Файл с отчетом будет автоматически создан в корневой папке проекта по завершении работы всех потоков парсинга.
